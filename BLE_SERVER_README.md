# BLE服务器使用说明

## 概述

这个BLE服务器实现了一个简单的蓝牙低功耗外设，提供心跳服务。服务器会定时发送心跳数据，其他设备可以连接并接收这些数据。

## 功能特性

- **心跳服务**: 每秒发送一次心跳数据
- **自动广播**: 启动后自动广播服务
- **客户端连接管理**: 支持多个客户端同时连接
- **实时状态显示**: 显示服务器状态和心跳计数

## 使用方法

### 1. 启动服务器

1. 打开应用，点击"BLE服务器"按钮
2. 确保蓝牙已开启并授予必要权限
3. 点击"启动服务器"按钮
4. 服务器开始运行，等待客户端连接

### 2. 连接客户端

其他设备可以通过以下方式连接到服务器：

- 扫描附近的BLE设备
- 查找服务UUID: `12345678-1234-1234-1234-123456789ABC`
- 连接并订阅特征UUID: `87654321-4321-4321-4321-CBA987654321`

### 3. 接收心跳数据

客户端连接后会自动接收心跳数据，数据格式为：
```
Heartbeat #1 - 1640995200000
Heartbeat #2 - 1640995201000
...
```

## 技术细节

### 服务结构

- **服务UUID**: `12345678-1234-1234-1234-123456789ABC`
- **特征UUID**: `87654321-4321-4321-4321-CBA987654321`
- **特征属性**: READ + NOTIFY
- **描述符**: 客户端特征配置描述符

### 心跳数据

心跳数据包含：
- 计数器：递增的数字
- 时间戳：当前系统时间

### 权限要求

- `BLUETOOTH_ADVERTISE` (Android 12+)
- `BLUETOOTH_CONNECT` (Android 12+)
- `ACCESS_FINE_LOCATION` (Android 6.0-11)

## 代码结构

### BleServer.java
主要的服务器实现类，包含：
- GATT服务器创建和管理
- 心跳服务定义
- 客户端连接处理
- 心跳数据发送

### BleServerActivity.java
用户界面Activity，提供：
- 服务器启动/停止控制
- 状态显示
- 心跳计数显示

## 注意事项

1. 确保设备支持BLE外设模式
2. 某些设备可能需要特殊权限或设置
3. 心跳间隔可以通过修改`HEARTBEAT_INTERVAL`常量调整
4. 服务器停止时会自动清理资源

## 故障排除

### 服务器启动失败
- 检查蓝牙是否开启
- 确认权限已授予
- 查看日志输出

### 客户端无法连接
- 确认服务器已启动
- 检查服务UUID是否正确
- 确认设备在扫描范围内

### 心跳数据不接收
- 检查客户端是否正确订阅了通知
- 确认特征UUID匹配
- 查看服务器日志确认数据发送状态 